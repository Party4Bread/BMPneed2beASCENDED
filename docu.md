# ㅁㅁTV) 하라는 알고리즘공부는 안하고 덕질을 하는 개발자가 있다?

~~삐슝뿌슝빠슝~~

6하원칙의 순서는 지켜지지 않습니다. 즐거운 코딩을 위해서 써진 글이기 때문입니다. (웃음)

## 왜 했는가

일본 여행 도중에 너무나도 프로그래밍을 하고 싶은 나머지 소규모 프로젝트를 하나 하고 싶어져서 뭘할까 고민을 하다가 예전에 몇번이고 시도해봤던 이미지 표시를 이번에는 완전 pure 한 C#으로 만들어보자고 생각하여 만들게 돼었습니다.

## 언제 했는가

여행도중에 첫날밤 2시간 정도하고 Universal Studio Japan에서 기동코딩(대기줄에서 움직이며 코딩하는것)으로 약 10분 둘째날에 1시간 마무리해서 1차 버전을 완성했습니다.

## 무엇을 했는가

콘솔에 주어진 이미지를 출력할수있는 프로그램을 만들었습니다.

만들면서 목표한것은 굉장히 쓸데없고 이상하지만 그 어떤거보다 간지(멋)이 폭발하는 것을 목표로 했습니다.

## 어떻게 했는가

다음과 같은 방법으로 출력을 만들었습니다.

`이미지 로드->이미지 색상 조정->이미지 크기 조정->색상 (유사)양자화->출력`

### 이미지 로드

별다르게 특별한 기술은 적용되지 않았습니다. 그냥 Bitmap 객체로 이미지를 불러들입니다.

### 이미지 색상 조정

양자화를 거친 이미지가 가끔 색상이 뭉개지거나 전부 비슷해저버리는 일이 생겨서 색상을 좀더 강렬하게 할 필요가 있었습니다. 채도를 올리는 방법이나 대비를 더 만드는 방법이 있습니다만, 만들었을때에는 대비만 올리고 채도는 올리지 않았습니다. 시간도 적었고 귀찮았으니까요. 사실 지금생각에는 안하는거도 나쁘지 않고 채도를 올리는게 더 성공적일거라는 생각이 듭니다. 나중에 해봐야죠.

### 이미지 크기 조정

C#의 정석대로라면 Graphics 객체를 통해서 다시 그리는게 정석인거 같은데 저는 Bitmap객체의 미리보기 이미지를 만드는 함수인 GetThumbnailImage함수를 이용해서 작은 사이즈의 이미지를 만들었습니다.

-----

여기까지는 비교적 쉬웠지만 이제 가장 큰 문제가 생겼습니다. 

![색상이 으깨짐](human1.png)

사이즈를 조정한 이미지는 콘솔에 출력하니 색상이 전부 이상하게 되어버렸습니다.

이유인즉슨, CMD는 색상을 16종류밖에 출력하지 못하고 1개의 색은 항상 검정으로 고정이기에 검정을 제외하고 15개의 색밖에 출력하지 못합니다. 하지만 예시로 넣은 이미지는 가로를 100으로 조정한 후에도 1600개의 색이 쓰였기 때문에 아주 많은 색이 죽어버리게 됩니다.

따라서 이를 해결하기 위해선 이미지에 사용된 색상의 수를 줄여야 했습니다.

----------

### 색상 (유사)양자화

색상의 수를 줄이기 위해서는 양자화를 거쳐야 합니다. 사용가능한 색의 개수가 16개였기 때문에 4비트 양자화를 생각해 보았지만 아는 알고리즘이 없어서 만들수가 없었습니다. 그래서 최근에 알고리즘 연구반 부동아리에서 진행한 프로젝트에 이용했던 K Clusturing을 써보기로 했습니다.

방법은 간단합니다. RGB로 3차원 색좌표를 만든뒤 K means clustering을 수행하는것 입니다.

구현은 이미 python에서 K medians clustering을 해보았기 때문에 비교적 쉽게 할수 있었습니다.

K 값은 15개 되어서 15개의 중심점이 나오겠네요. 이 15개의 중심점을 해당점이 가장 가까운 중심점인 색상에 배정합니다. 이 과정을 통해서 색상이 15개만 사용된 그림을 만들수 있습니다.

------------------

### 출력

최대한 프로젝트를 빠르게 끝내고 싶어서 ■ 문자에 색을 입혀서 출력했습니다 [Colorful.Console](http://colorfulconsole.com/)라이브러리를 썻습니다. 이 글을 쓰면서 생각해보니 묶어서 출력하는게 더 빨랐을꺼같네요

-------------

## 어찌 됬는가

